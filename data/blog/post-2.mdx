---
  title: Next.js学习
  publishedAt: 2023-03-12T18:01:40Z
  summary: 查看全文>>
  tags: ["React","Next.js"]
---

Next.js 学习

官方文档地址：https://nextjs.org/

要有效地使用 Next.js，熟悉 JavaScript、React 和相关的 Web 开发概念是前提

1. 相关技术

1. unpkg：https://unpkg.com/ 
  a. 一个快速的全球内容交付网络，适用于 npm 上的所有内容。使用它可以使用如下 URL 快速轻松地从任何包中加载任何文件：unpkg.com/:package@:version/:file
  b. 一个CDN服务
2. 

1. 快速创建一个Next.js应用

开发环境

1. 安装Node.js环境到你的电脑 ；Node.js > 14.6.0 或者最近稳定版本（推荐使用[nvm](https://www.runoob.com/w3cnote/nvm-manager-node-versions.html)管理node版本）
2. 一台生产力电脑
3. 一个自己熟悉的编辑器，这里推荐VSCode或者WebStorm
4. 跟着[官方教程](https://nextjs.org/docs/getting-started)， 
  a. init code：pnpm create next-app,有选择，选择你需要的能力即可
  b. npm run dev 启动项目
  c. 

2. Next.js如何工作

Next.js 被一些世界上最大的公司使用，它使您能够通过扩展最新的 React 功能并集成强大的基于 Rust 的 JavaScript 工具来创建全栈 Web 应用程序以实现最快的构建。

1. 从开发环境到生产环境

讲了，开发环境和生产环境的区别，Next.js对此做的优化

开发环境和生产环境区别

● 在开发期间，您正在本地计算机上构建和运行应用程序。
● 投入生产是让您的应用程序准备好部署和供用户使用的过程。

Next.js针对其进行的优化

● Next.js 会针对开发人员及其构建应用程序的经验进行优化。它具有旨在改善开发人员体验的功能，例如 TypeScript 和 ESLint 集成、快速刷新等。
● 在生产阶段，Next.js 会针对最终用户以及他们使用该应用程序的体验进行优化。它旨在转换代码以使其具有高性能和可访问性。 由于每个环境都有不同的考虑因素和目标，因此将应用程序从开发转移到生产需要做很多事情。例如，应用程序代码需要编译、捆绑、缩小和代码拆分。

Next.js真的可以让你的应用更加优秀

因为 Next.js 有一个用 Rust 编写的编译器，一种低级编程语言，以及 SWC，一个可用于编译、缩小、捆绑等的平台。

接下来，我们具体看下Next.js为我们做了什么吧！

2. 编译

将我们写的代码，通过Next.js的魔法转化游览器能够解析的JavaScript代码，



我们编写对开发人员更友好的语言编写代码，例如 JSX、TypeScript 和现代版本的 JavaScript。虽然这些语言提高了开发人员的效率和信心，但游览器却并不知道这是什么，我们需要将其编译为游览器理解的代码，

编译发生时机

编译发生在您编辑代码的开发阶段，并且作为构建步骤的一部分，为您的应用程序做好生产准备。💎💎

编译是指获取一种语言的代码并将其输出为另一种语言或该语言的另一个版本的过程。

3. 压缩

我们项目源码可能包含代码运行所不需要的额外信息，例如注释、空格、缩进和多行（为了给开发者看）。生产环境打包好的代码是不需要的，因为它是给游览器理解，所有我们打包的时候需要移除这些额外信息



Next.js的压缩

在 Next.js 中，JavaScript 和 CSS 文件会自动缩小以用于生产。💎💎

缩小是在不更改代码功能的情况下删除不必要的代码格式和注释的过程。目标是通过减小文件大小来提高应用程序的性能。

4. 捆绑

开发者通过拆解一个应用为：模块，组件，函数，方法，类，第三方库等等；通过导入导出实现功能，这同时创建了一个复杂的文件依赖关系网



为了减少用户访问网页时对文件的请求数量（请求文件数减少，页面加载就更快）。捆绑是解决网络依赖关系并将文件（或模块）合并（或“打包”）为浏览器优化捆绑包的过程

编译是将代码转换成浏览器可以解析的东西。捆绑正在解决您的应用程序依赖关系图并减少文件数量。

5. 代码拆分

代码拆分是将应用程序的包拆分为每个入口点所需的较小块的过程。目标是通过仅加载运行该页面所需的代码来缩短应用程序的初始加载时间。



开发人员通常将他们的应用程序分成多个页面，可以从不同的 URL 访问这些页面。这些页面中的每一个都成为应用程序的唯一入口点。

Next.js 内置了对代码拆分的支持。在构建步骤中，您的 pages/ 目录中的每个文件都将自动代码拆分为自己的 JavaScript 包。

未来：

● 页面之间共享的任何代码也被拆分到另一个包中，以避免在进一步导航时重新下载相同的代码。
● 初始页面加载后，Next.js 可以开始预加载用户可能导航到的其他页面的代码。
● 动态导入是另一种手动拆分最初加载代码的方法。

6. 构建时和运行时

两个非常重要的概念，帮助理解Next.js的底层工作原理

构建时间（或构建步骤）是为生产应用程序代码准备的一系列步骤的名称。 当您构建应用程序时，Next.js 会将您的代码转换为生产优化文件，以准备部署到服务器并供用户使用。这些文件包括：

● 静态生成页面的 HTML 文件
● 用于在服务器上呈现页面的 JavaScript 代码
● 使页面在客户端交互的 JavaScript 代码
● CSS文件

运行时（或请求时间）是指在构建和部署应用程序后，应用程序响应用户请求而运行的时间段。 接下来，让我们讨论一下本节中介绍的一些术语，例如客户端、服务器和渲染。

7. 客户端和服务端

在 Web 应用程序的上下文中，

●  客户端是指：用户设备上的浏览器，它向服务器发送应用程序代码请求。然后它将从服务器接收到的响应转换为用户可以与之交互的界面。 
●  服务端：指数据中心的计算机，它存储您的应用程序代码，接收来自客户端的请求，进行一些计算，并发回适当的响应。 



7. 渲染

将您在 React 中编写的代码转换为 UI 的 HTML 表示形式是不可避免的工作单元。这个过程称为渲染。

渲染可以在服务器或客户端上进行。它可以在构建时提前发生，也可以在运行时针对每个请求发生。 使用 Next.js，可以使用三种类型的渲染方法：

● 服务器端渲染
● 静态站点生成
● 客户端渲染

1. 预渲染

服务器端渲染和静态站点生成也称为预渲染，因为 外部数据的获取 和  React 组件到 HTML 的转换 发生在结果发送到客户端之前。

2. 客户端渲染 VS预渲染

在标准的 React 应用程序中，浏览器从服务器接收一个空的 HTML shell 以及构建 UI 的 JavaScript 指令。这称为客户端呈现，因为初始呈现工作发生在用户的设备上。



注意：您可以选择使用 React 的 useEffect() 或数据获取挂钩（如 useSWR）获取数据，从而为 Next.js 应用程序中的特定组件使用客户端呈现。

相比之下，Next.js 默认预渲染每个页面。预渲染意味着 HTML 是预先在服务器上生成的，而不是由用户设备上的 JavaScript 完成的。 实际上，这意味着对于完全由客户端呈现的应用程序，用户将在完成呈现工作时看到一个空白页面。与预渲染应用相比，用户将看到构建的 HTML，所以预渲染是对用户更加友好的渲染



接下来，具体看下两种预渲染：

3. 服务端渲染

使用服务器端呈现，页面的 HTML 是在服务器上为每个请求生成的。然后将生成的 HTML、JSON 数据和使页面具有交互性的 JavaScript 指令发送到客户端。 在客户端，HTML 用于显示快速的非交互式页面，而 React 使用 JSON 数据和 JavaScript 指令使组件具有交互性（例如，将事件处理程序附加到按钮）。这个过程称为水合作用。 在 Next.js 中，您可以使用 getServerSideProps 选择服务器端呈现页面。

注意：React 18 和 Next 12 引入了 React 服务端组件的 alpha 版本。服务器组件完全在服务器上呈现，不需要客户端 JavaScript 来呈现。此外，服务端组件允许开发人员在服务器上保留一些逻辑，并且只将该逻辑的结果发送给客户端。这减少了发送到客户端的包大小并提高了客户端渲染性能。了解有关 React 服务端的更多信息 组件在这里。

4. 静态站点生成

使用静态站点生成，HTML 是在服务器上生成的。但与服务器端呈现不同的是，在运行时没有服务器。取而代之的是，在部署应用程序时，在构建时生成一次内容，HTML 存储在 CDN 中并为每个请求重新使用。 在Next.js 中，您可以选择使用 getStaticProps 静态生成页面。

注意：您可以在构建网站后使用[增量静态重新生成来](https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration)创建或更新静态页面。这意味着如果您的数据发生变化，您不必重建整个站点。

Next.js 的美妙之处在于，您可以逐页为您的用例选择最合适的呈现方法，无论是静态站点生成、服务器端呈现还是客户端呈现。要详细了解哪种渲染方法适合您的特定用例，请参阅数据获取文档。 在下一节中，我们将讨论您的代码在部署后可以存储或运行的位置。

8. 网络

了解应用程序代码的存储位置和部署到网络后的运行位置很有帮助。您可以将网络视为能够共享资源的链接计算机（或服务器）。

对于 Next.js 应用程序，您的应用程序代码可以分发到原始服务器、内容分发网络 (CDNs) 和边缘。让我们看看它们分别是什么：

1. 原始服务器

正如我们之前讨论的，服务器是指存储和运行应用程序代码原始版本的主计算机。 我们使用术语源来区分此服务器与应用程序代码可以分发到的其他地方，例如 CDN 服务器和边缘服务器。 当源服务器收到请求时，它会在发送响应之前进行一些计算。该计算工作的结果可以移动到 CDN（内容分发网络）。

2. 内容分发网络

CDN 在全球多个位置存储静态内容（如 HTML 和图像文件），并放置在客户端和源服务器之间。当有新请求进来时，距离用户最近的 CDN 位置可以使用缓存的结果进行响应。



这减少了源端的负载，因为不必在每个请求上都进行计算。它还使用户更快，因为响应来自地理位置更接近他们的位置。 在 Next.js 中，由于可以提前完成预渲染，因此 CDN 非常适合存储工作的静态结果——使内容交付更快。

3. 边缘

边缘是网络边缘（或边缘）的广义概念，最接近用户。 CDN 可以被视为“边缘”的一部分，因为它们将静态内容存储在网络的边缘（边缘）。 与 CDN 类似，边缘服务器分布在世界各地的多个位置。但与存储静态内容的 CDN 不同，一些边缘服务器可以运行一小段代码。 这意味着缓存和代码执行都可以在靠近用户的边缘完成。 通过将一些传统上在客户端或服务器端完成的工作转移到边缘，您可以使您的应用程序性能更高，因为它减少了发送到客户端的代码量，并且用户的部分请求不必全部执行返回原始服务器的方式 - 从而减少延迟。请在此处查看带有 Next.js 的 Edge 示例。 在 Next.js 中，您可以使用中间件在边缘运行代码，很快就会使用 React 服务器组件。

END

恭喜你看到了这里，Next.js的基础课程已经结束，现在 我们应该知道Next.js可以帮我们快速创建一个基于react的应用程序，它能够帮我们更加出色的完成打包，构建，让我们的应用程序更加快速的响应给用户，可以争对开发环境和部署环境进行特殊设置

---
欢迎前往原文讨论：[https://github.com/chaseFunny/blog/issues/2](https://github.com/chaseFunny/blog/issues/2)
